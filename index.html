<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aapki Khabar</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    header { background: #d32f2f; color: #fff; padding: 18px 12px; text-align: center; }
    header h2 { margin: 0; font-size: 26px; }
    header p { margin: 6px 0 0; opacity: 0.95; }

    .lang-row{
      display: flex; gap: 12px; justify-content:center; margin-top: 14px;
    }
    .lang-btn{
      border: none; border-radius: 999px; padding: 10px 18px;
      font-size: 15px; cursor: pointer; font-weight: 700;
      background: rgba(255,255,255,0.12); color: #fff;
      outline: 2px solid rgba(255,255,255,0.25);
    }
    .lang-btn.active{ background:#fff; color:#d32f2f; outline: none; }

    /* Categories chips row */
    .cats-wrap{
      background: #fff;
      padding: 10px 10px 6px;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    }
    .cats{
      display: flex;
      overflow-x: auto;
      gap: 10px;
      padding: 6px 6px 10px;
      scrollbar-width: none;
    }
    .cats::-webkit-scrollbar{ display:none; }
    .chip{
      border: none;
      padding: 10px 16px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 700;
      white-space: nowrap;
      background: #f1f1f1;
      color: #111;
    }
    .chip.active{
      background: #d32f2f;
      color: #fff;
    }

    .meta-bar{
      text-align:center;
      padding: 6px 10px 10px;
      font-size: 13px;
      color:#666;
    }

    .news { padding: 14px 12px 40px; }

    .card {
      background: #fff;
      margin-bottom: 14px;
      border-radius: 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    .card h3 { margin: 14px 14px 6px; font-size: 20px; line-height: 1.25; }
    .card p { margin: 0 14px 10px; color: #444; line-height: 1.5; font-size: 15px; }
    .meta { font-size: 13px; color: #777; margin: 0 14px 14px; }

    .btn-row{
      display:flex;
      gap:10px;
      padding: 0 14px 14px;
      align-items:center;
      justify-content:flex-start;
    }
    .read-btn{
      background:#d32f2f;
      color:#fff;
      border:none;
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 800;
      cursor:pointer;
    }
    .full-content{
      display:none;
      padding: 0 14px 14px;
      margin-top: -6px;
      color:#222;
      font-size: 15px;
      line-height: 1.6;
      border-top: 1px solid #eee;
      padding-top: 12px;
    }

    /* Ads box */
    .ad-box{
      background: #fff;
      border: 2px dashed rgba(0,0,0,0.18);
      border-radius: 14px;
      padding: 16px;
      margin: 14px 0;
      text-align:center;
      color:#333;
      font-weight: 800;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .ad-box small{
      display:block;
      margin-top: 6px;
      font-weight: 600;
      color:#666;
    }

    .empty{
      background:#fff;
      border-radius: 14px;
      padding: 16px;
      text-align:center;
      color:#444;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    }
  </style>
</head>

<body>

<header>
  <h2>üóûÔ∏è Aapki Khabar</h2>
  <p>‡§∏‡§Æ‡§ù‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ñ‡§¨‡§∞‡•á‡§Ç ‚Ä¢ Easy to Understand News</p>

  <div class="lang-row">
    <button class="lang-btn active" id="btnHi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
    <button class="lang-btn" id="btnEn">English</button>
  </div>
</header>

<div class="cats-wrap">
  <div class="cats" id="catsRow">
    <!-- chips inserted by JS -->
  </div>
  <div class="meta-bar" id="lastUpdated">Last updated: --:--</div>
</div>

<div class="news" id="newsList">
  Loading news...
</div>

<script>
  // ‚úÖ Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDyFelhS-cksx0vKkKwllROaf-qXXYoIDM",
    authDomain: "aapki-khabar-171e9.firebaseapp.com",
    projectId: "aapki-khabar-171e9"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ‚úÖ categories list (fixed name)
  const CATEGORIES = [
    "All",
    "Finance",
    "Government",
    "World",
    "Court & Law",
    "Sports",
    "Climate"
  ];

  let currentCategory = "All";
  let currentLang = "hi";

  // Auto refresh
  const AUTO_REFRESH_MS = 10 * 60 * 1000; // 10 minutes
  let refreshTimer = null;

  function formatTime(d){
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    const ss = String(d.getSeconds()).padStart(2,'0');
    return `${hh}:${mm}:${ss}`;
  }

  function setLastUpdated(){
    document.getElementById("lastUpdated").innerText =
      "Last updated: " + formatTime(new Date());
  }

  function renderCategoryChips(){
    const row = document.getElementById("catsRow");
    row.innerHTML = "";

    CATEGORIES.forEach(cat => {
      const btn = document.createElement("button");
      btn.className = "chip" + (cat === currentCategory ? " active" : "");
      btn.innerText = cat;

      btn.onclick = () => {
        currentCategory = cat;

        // update active chip UI
        [...row.children].forEach(c => c.classList.remove("active"));
        btn.classList.add("active");

        // load news again
        loadNews();
      };

      row.appendChild(btn);
    });
  }

  function setLangUI(){
    const btnHi = document.getElementById("btnHi");
    const btnEn = document.getElementById("btnEn");

    if(currentLang === "hi"){
      btnHi.classList.add("active");
      btnEn.classList.remove("active");
    }else{
      btnEn.classList.add("active");
      btnHi.classList.remove("active");
    }
  }

  document.getElementById("btnHi").onclick = () => {
    currentLang = "hi";
    setLangUI();
    loadNews();
  };

  document.getElementById("btnEn").onclick = () => {
    currentLang = "en";
    setLangUI();
    loadNews();
  };

  // ‚úÖ MAIN function: load news (auto refresh compatible)
  function loadNews(){
    const container = document.getElementById("newsList");
    container.innerHTML = "Loading news...";

    db.collection("news")
      .orderBy("createdAt", "desc")
      .get()
      .then(snapshot => {
        container.innerHTML = "";
        let countNews = 0;

        snapshot.forEach(doc => {
          const n = doc.data();

          // Filter by category
          if(currentCategory !== "All" && n.category !== currentCategory){
            return;
          }

          const langData = n.language && n.language[currentLang];
          if(!langData) return;

          const card = document.createElement("div");
          card.className = "card";

          card.innerHTML = `
            <h3>${langData.headline || ""}</h3>
            <p>${langData.summary || ""}</p>
            <div class="btn-row">
              <button class="read-btn">Read Full News</button>
            </div>
            <div class="full-content">${(langData.content || "").replace(/\n/g, "<br/>")}</div>
            <div class="meta">${n.category || ""} ‚Ä¢ ${n.source || ""}</div>
          `;

          const btn = card.querySelector(".read-btn");
          const full = card.querySelector(".full-content");
          btn.onclick = () => {
            full.style.display = (full.style.display === "block") ? "none" : "block";
            btn.innerText = (full.style.display === "block") ? "Hide Full News" : "Read Full News";
          };

          container.appendChild(card);
          countNews++;

          // ‚úÖ Ad after every 2 news
          if(countNews % 2 === 0){
            const ad = document.createElement("div");
            ad.className = "ad-box";
            ad.innerHTML = `
              Advertisement
              <small>Ads will appear here (earning model)</small>
            `;
            container.appendChild(ad);
          }
        });

        if(container.innerHTML.trim() === ""){
          container.innerHTML = `<div class="empty">No news available.</div>`;
        }

        setLastUpdated();
      })
      .catch(err => {
        console.error(err);
        container.innerHTML = `<div class="empty">Error loading news.</div>`;
      });
  }

  // ‚úÖ Auto refresh setup
  function startAutoRefresh(){
    if(refreshTimer) clearInterval(refreshTimer);

    refreshTimer = setInterval(() => {
      loadNews();
    }, AUTO_REFRESH_MS);
  }

  // INIT
  renderCategoryChips();
  setLangUI();
  loadNews();
  startAutoRefresh();
</script>

</body>
</html>

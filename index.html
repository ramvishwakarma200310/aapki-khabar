<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- ‚úÖ Responsive -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Aapki Khabar</title>

  <!-- ‚úÖ PWA REQUIRED (YOU ASKED TO ADD THIS) -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#d32f2f">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    header { background: #d32f2f; color: #fff; padding: 15px; text-align: center; }
    .news { padding: 15px; }

    .lang-btns {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 10px;
    }
    .lang-btns button {
      border: 2px solid rgba(255,255,255,0.4);
      background: rgba(255,255,255,0.15);
      color: #fff;
      padding: 10px 18px;
      border-radius: 22px;
      font-size: 16px;
      cursor: pointer;
    }
    .lang-btns button.active {
      background: #fff;
      color: #d32f2f;
      font-weight: bold;
    }

    .category-bar {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 12px;
      background: #fff;
      border-bottom: 1px solid #eee;
      position: sticky;
      top: 0;
      z-index: 20;
    }
    .category-bar::-webkit-scrollbar { display: none; }

    .cat-btn {
      padding: 10px 16px;
      border-radius: 25px;
      border: none;
      background: #eee;
      color: #333;
      cursor: pointer;
      white-space: nowrap;
      font-weight: 600;
    }
    .cat-btn.active {
      background: #d32f2f;
      color: #fff;
    }

    .card {
      background: #fff;
      margin-bottom: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      overflow: hidden;
      padding: 15px;
    }
    .card h2 { margin: 0 0 10px; font-size: 20px; }
    .card p { margin: 0 0 10px; color: #444; line-height: 1.5; }
    .meta {
      font-size: 12px;
      color: #777;
      margin-top: 8px;
    }
    .read-btn {
      background: #d32f2f;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: 700;
    }
    .full-content {
      display: none;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #eee;
      color: #222;
      white-space: pre-line;
      line-height: 1.6;
    }

    .ad-box {
      background: #fff;
      border: 2px dashed #ccc;
      border-radius: 12px;
      padding: 18px;
      text-align: center;
      margin: 12px 0;
      color: #666;
      font-weight: 700;
    }

    .last-updated {
      text-align: center;
      font-size: 12px;
      color: #666;
      padding: 10px 0;
    }
  </style>
</head>

<body>

<header>
  <h2>üóûÔ∏è Aapki Khabar</h2>
  <p>‡§∏‡§Æ‡§ù‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ñ‡§¨‡§∞‡•á‡§Ç ‚Ä¢ Easy to Understand News</p>

  <div class="lang-btns">
    <button id="btnHindi" class="active">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
    <button id="btnEnglish">English</button>
  </div>
</header>

<!-- ‚úÖ Categories -->
<div class="category-bar" id="categoryBar"></div>

<div class="last-updated" id="lastUpdated"></div>

<div class="news" id="newsList">
  Loading news...
</div>

<script>
  // ‚úÖ Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDyFelhS-cksx0vKkKwllROaf-qXXYoIDM",
    authDomain: "aapki-khabar-171e9.firebaseapp.com",
    projectId: "aapki-khabar-171e9"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ‚úÖ Settings
  let currentLang = "hi";
  let currentCategory = "All";
  const AUTO_REFRESH_TIME = 10 * 60 * 1000; // 10 minutes

  // ‚úÖ Categories required
  const categories = [
    "All",
    "Finance",
    "Government",
    "World",
    "Court & Law",
    "Sports",
    "Climate"
  ];

  // ‚úÖ Build category buttons
  const categoryBar = document.getElementById("categoryBar");
  categories.forEach(cat => {
    const btn = document.createElement("button");
    btn.className = "cat-btn" + (cat === "All" ? " active" : "");
    btn.innerText = cat;
    btn.onclick = () => {
      document.querySelectorAll(".cat-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentCategory = cat;
      loadNews();
    };
    categoryBar.appendChild(btn);
  });

  // ‚úÖ Language buttons
  const btnHindi = document.getElementById("btnHindi");
  const btnEnglish = document.getElementById("btnEnglish");

  btnHindi.onclick = () => {
    currentLang = "hi";
    btnHindi.classList.add("active");
    btnEnglish.classList.remove("active");
    loadNews();
  };

  btnEnglish.onclick = () => {
    currentLang = "en";
    btnEnglish.classList.add("active");
    btnHindi.classList.remove("active");
    loadNews();
  };

  function updateTime() {
    const t = new Date();
    const timeString = t.toLocaleTimeString();
    document.getElementById("lastUpdated").innerText = "Last updated: " + timeString;
  }

  // ‚úÖ MAIN LOAD NEWS FUNCTION
  function loadNews() {
    const container = document.getElementById("newsList");
    container.innerHTML = "Loading news‚Ä¶";

    db.collection("news")
      .orderBy("createdAt", "desc")
      .get()
      .then(snapshot => {
        container.innerHTML = "";
        let count = 0;

        snapshot.forEach(doc => {
          const n = doc.data();

          // ‚úÖ Category filter
          if (currentCategory !== "All" && n.category !== currentCategory) {
            return;
          }

          // ‚úÖ language map data
          const langData = n.language?.[currentLang];
          if (!langData) return;

          const card = document.createElement("div");
          card.className = "card";

          card.innerHTML = `
            <h2>${langData.headline || ""}</h2>
            <p>${langData.summary || ""}</p>
            <div class="meta">${n.category || ""} ‚Ä¢ ${n.source || ""}</div>
            <button class="read-btn">Read Full News</button>
            <div class="full-content">${langData.content || ""}</div>
          `;

          const btn = card.querySelector(".read-btn");
          const full = card.querySelector(".full-content");

          btn.onclick = () => {
            full.style.display = (full.style.display === "block") ? "none" : "block";
          };

          container.appendChild(card);
          count++;

          // ‚úÖ Ad after every 2 news
          if (count % 2 === 0) {
            const ad = document.createElement("div");
            ad.className = "ad-box";
            ad.innerText = "Advertisement"
              <small>Ads will appear here (earning model)</small>;
            container.appendChild(ad);
          }
        });

        if (container.innerHTML.trim() === "") {
          container.innerHTML = "No news available.";
        }

        updateTime();
      })
      .catch(err => {
        console.error(err);
        container.innerHTML = "Error loading news.";
      });
  }

  // ‚úÖ Initial load
  loadNews();
  updateTime();

  // ‚úÖ Auto refresh every 10 min
  setInterval(() => {
    loadNews();
  }, AUTO_REFRESH_TIME);
</script>

<!-- ‚úÖ Service Worker Register (YOU ASKED TO ADD THIS) -->
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js")
      .then(() => console.log("Service Worker Registered ‚úÖ"))
      .catch(err => console.log("Service Worker Error ‚ùå", err));
  }
</script>

</body>
</html>

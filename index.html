<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aapki Khabar</title>

  <!-- ‚úÖ PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#d32f2f">

  <!-- ‚úÖ Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
    }

    header {
      background: #d32f2f;
      color: #fff;
      padding: 18px 10px;
      text-align: center;
    }

    /* ‚úÖ Prevent Google Translate from changing header */
    .notranslate { translate: no; }
    header * { -webkit-text-size-adjust: 100%; }

    header h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.3px;
    }

    header p {
      margin: 8px 0 0;
      font-size: 16px;
      opacity: 0.95;
    }

    .lang-switch {
      margin-top: 14px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .lang-btn {
      border: 0;
      padding: 10px 24px;
      font-size: 16px;
      border-radius: 999px;
      cursor: pointer;
      background: rgba(255,255,255,0.2);
      color: #fff;
      font-weight: 700;
      border: 2px solid rgba(255,255,255,0.25);
    }

    .lang-btn.active {
      background: #fff;
      color: #d32f2f;
      border: 2px solid #fff;
    }

    .category-bar {
      background: #fff;
      padding: 12px 12px;
      overflow-x: auto;
      white-space: nowrap;
      border-bottom: 1px solid #eee;
      -webkit-overflow-scrolling: touch;
    }

    .category-btn {
      display: inline-block;
      margin-right: 10px;
      padding: 10px 18px;
      border-radius: 999px;
      border: 0;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      background: #f0f0f0;
      color: #111;
    }

    .category-btn.active {
      background: #d32f2f;
      color: #fff;
    }

    #lastUpdated {
      text-align:center;
      color:#777;
      font-size:13px;
      margin:10px 0;
    }

    .news {
      padding: 15px;
    }

    .card {
      background: #fff;
      margin-bottom: 15px;
      border-radius: 14px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 16px;
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 20px;
      font-weight: 800;
    }

    .card p {
      margin: 0 0 12px;
      font-size: 15px;
      line-height: 1.5;
      color: #444;
    }

    .meta {
      font-size: 12px;
      color: #777;
      margin-top: 6px;
    }

    .read-btn {
      margin-top: 10px;
      background: #d32f2f;
      color: #fff;
      padding: 10px 14px;
      border: 0;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
    }

    .full-content {
      display: none;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #eee;
      color: #333;
      font-size: 15px;
      line-height: 1.6;
    }

    .ad-box {
      background: #ffffff;
      border: 2px dashed #d32f2f55;
      color: #d32f2f;
      padding: 18px;
      text-align: center;
      border-radius: 14px;
      margin: 12px 0 18px;
      font-weight: 800;
    }
  </style>
</head>

<body>

<header class="notranslate">
  <h1>üóûÔ∏è Aapki Khabar</h1>
  <p>‡§∏‡§Æ‡§ù‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ñ‡§¨‡§∞‡•á‡§Ç ‚Ä¢ Easy to Understand News</p>

  <div class="lang-switch">
    <button id="btnHi" class="lang-btn active">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
    <button id="btnEn" class="lang-btn">English</button>
  </div>
</header>

<!-- ‚úÖ Categories -->
<div class="category-bar" id="categoryBar">
  <!-- Buttons will be injected -->
</div>

<div id="lastUpdated"></div>

<div class="news" id="newsList">
  Loading news...
</div>

<script>
  // ‚úÖ Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDyFelhS-cksx0vKkKwllROaf-qXXYoIDM",
    authDomain: "aapki-khabar-171e9.firebaseapp.com",
    projectId: "aapki-khabar-171e9"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ‚úÖ App state
  let currentCategory = "All";
  let currentLang = "hi";
  let unsubscribeNews = null;

  const categories = ["All", "Finance", "Government", "World", "Court & Law", "Sports", "Climate"];

  function renderCategories() {
    const bar = document.getElementById("categoryBar");
    bar.innerHTML = "";

    categories.forEach(cat => {
      const btn = document.createElement("button");
      btn.className = "category-btn" + (cat === currentCategory ? " active" : "");
      btn.innerText = cat;

      btn.onclick = () => {
        currentCategory = cat;
        renderCategories();
        loadNewsRealtime();
      };

      bar.appendChild(btn);
    });
  }

  function updateLastUpdatedTime() {
    const el = document.getElementById("lastUpdated");
    const now = new Date();
    el.innerText = `Last updated: ${now.toLocaleTimeString()}`;
  }

  function loadNewsRealtime() {
    const container = document.getElementById("newsList");
    container.innerHTML = "Loading news‚Ä¶";

    // ‚úÖ remove old realtime listener
    if (unsubscribeNews) unsubscribeNews();

    let query = db.collection("news").orderBy("createdAt", "desc");

    // ‚úÖ category filter
    if (currentCategory !== "All") {
      query = query.where("category", "==", currentCategory);
    }

    unsubscribeNews = query.onSnapshot(
      (snapshot) => {
        container.innerHTML = "";
        let count = 0;

        snapshot.forEach(doc => {
          const n = doc.data();

          const langData = n.language?.[currentLang];
          if (!langData) return;

          const card = document.createElement("div");
          card.className = "card";

          card.innerHTML = `
            <h2>${langData.headline || ""}</h2>
            <p>${langData.summary || ""}</p>
            <button class="read-btn">Read Full News</button>
            <div class="meta">${n.category || ""} ‚Ä¢ ${n.source || ""}</div>
            <div class="full-content">${langData.content || ""}</div>
          `;

          const btn = card.querySelector(".read-btn");
          const full = card.querySelector(".full-content");

          btn.onclick = () => {
            full.style.display = (full.style.display === "block") ? "none" : "block";
          };

          container.appendChild(card);
          count++;

          // ‚úÖ Ad after every 2 news
          if (count % 2 === 0) {
            const ad = document.createElement("div");
            ad.className = "ad-box";
            ad.innerText = "Advertisement";
            container.appendChild(ad);
          }
        });

        if (container.innerHTML.trim() === "") {
          container.innerHTML = "No news available in this category.";
        }

        updateLastUpdatedTime();
      },
      (err) => {
        console.error(err);
        container.innerHTML = "Error loading news.";
      }
    );
  }

  // ‚úÖ Language switch
  document.getElementById("btnHi").onclick = () => {
    currentLang = "hi";
    document.getElementById("btnHi").classList.add("active");
    document.getElementById("btnEn").classList.remove("active");
    loadNewsRealtime();
  };

  document.getElementById("btnEn").onclick = () => {
    currentLang = "en";
    document.getElementById("btnEn").classList.add("active");
    document.getElementById("btnHi").classList.remove("active");
    loadNewsRealtime();
  };

  // ‚úÖ Start
  renderCategories();
  loadNewsRealtime();
  updateLastUpdatedTime();

  // ‚úÖ Auto refresh every 10 min
  setInterval(() => {
    console.log("Auto refresh triggered ‚úÖ");
    loadNewsRealtime();
  }, 10 * 60 * 1000);

</script>

<!-- ‚úÖ Service Worker -->
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js")
      .then(() => console.log("Service Worker Registered ‚úÖ"))
      .catch(err => console.log("Service Worker Error ‚ùå", err));
  }
</script>

</body>
</html>
